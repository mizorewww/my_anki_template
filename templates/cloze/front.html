<!-- Anki Cloze Modern Template - Front Side -->

<!-- KaTeX CSS -->
<link rel="stylesheet" href="_katex.min.css">

<!-- Highlight.js CSS (根据主题自动选择) -->
<link id="hljs-light" rel="stylesheet" href="_github.min.css" media="(prefers-color-scheme: light)">
<link id="hljs-dark" rel="stylesheet" href="_github-dark.min.css" media="(prefers-color-scheme: dark)">

<div class="content-wrapper">
    <!-- 
        关键修复: 直接在这里显示原始内容作为回退
        JavaScript 加载完成后会用渲染后的内容替换
        这样即使 JS 延迟加载，用户也能看到内容而不是黑屏
    -->
    <div id="rendered-content">{{cloze:Text}}</div>
</div>

<!-- 原始内容存储 -->
<div id="raw-content" style="display:none;">{{cloze:Text}}</div>

<script src="_marked.min.js"></script>
<script src="_katex.min.js"></script>
<script src="_highlight.min.js"></script>
<script src="_renderer.js"></script>

<script>
    // AnkiMobile 兼容: 立即尝试渲染，带重试机制
    (function () {
        var maxRetries = 50;
        var retryCount = 0;

        function tryRender() {
            if (typeof marked !== 'undefined' && typeof katex !== 'undefined' &&
                typeof hljs !== 'undefined' && typeof renderCloze === 'function') {
                renderCloze('raw-content', 'rendered-content', 'front');
            } else if (retryCount < maxRetries) {
                retryCount++;
                setTimeout(tryRender, 20);
            }
            // 如果超过最大重试次数,保留原始内容作为回退显示
        }

        // 立即开始尝试
        tryRender();
    })();
</script>